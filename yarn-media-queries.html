<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../yarn-state-behavior/yarn-state-behavior.html">

<!--
The `yarn-media-queries` element defines a set of responsive layout media queries to be configured once and used throughout your application via more general class names, e.g. `small-screen`.

Use the `yarn-media-queries` element *once* in your application.  Use the *behavior* on all elements you want to make responsive.
```
<link rel="import" href="../bower_components/yarn-media-queries/yarn-media-queries.html">
<my-app>
  <yarn-media-queries></yarn-media-queries>
  <responsive-element-one></responsive-element-one>
  <responsive-element-two></responsive-element-two>
</my-app>
```

The `yarn-media-query-behavior` applies the current winning media type to the host of custom elements.
-->

<dom-module id="yarn-media-queries">

  <style>
    :host {
      display: none;
    }
  </style>

  <template>

    <template is="dom-repeat" items="{{queries}}">
      <iron-media-query query="{{item.query}}" query-matches="{{item.queryMatches}}"></iron-media-query>
    </template>

  </template>

</dom-module>
<script>
  (function () {
    Polymer({

      is: 'yarn-media-queries',

      properties: {

        queries: {
          type: Array,
          notify: true,
          observer: '_queriesChanged'
        },

        size:{
          type: String,
          notify: true,
          observer: '_sizeChange'
        }
      },

      observers: [
        '_queryChange(queries.*)'
      ],

      behaviors: [
        YarnBehaviors.StateBehavior
      ],

      ready: function() {

        this.queries = [

          {
            query: '(min-width: 0px)',
            class: 'small-screen',
          },

          {
            query: '(min-width: 500px)',
            class: 'medium-screen'
          },

          {
            query: '(min-width: 1000px)',
            class: 'large-screen'
          },

          {
            query: '(min-width: 1000px) and (max-height: 1000px)',
            class: 'laptop-screen'
          },

        ];
      },

      _queriesChanged: function(queries){

        this.set('state.mediaQueries', queries);

        this.set('size', queries[0].class);
      },

      _queryChange: function(changedQuery){

        var size = this.queries[0].class

        for(var i = 0; i < this.queries.length; i++ ){

          var query = this.queries[i];

          if(query.queryMatches){

            size = query.class;
          }
        }

        this.set('size', size);
      },

      _sizeChange: function(size){

        this.set('state.mediaType', size);

        //console.log('size change: ', size);
      },

    });
  })();
</script>
